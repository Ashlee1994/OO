# 图书交易平台-应对需求变更报告 #

<li><a href= "https://github.com/liberion1994/oo/blob/master/%E4%BD%9C%E4%B8%9A2/%E4%BD%9C%E4%B8%9A2-%E5%9B%BE%E4%B9%A6%E4%BA%A4%E6%98%93%E5%B9%B3%E5%8F%B0%E7%9A%84%E5%8A%9F%E8%83%BD%E9%9C%80%E6%B1%82.md">甲方需求说明书</a></li>

<li><a href= "https://github.com/liberion1994/oo/blob/master/%E4%BD%9C%E4%B8%9A8/%E5%9B%BE%E4%B9%A6%E4%BA%A4%E6%98%93%E5%B9%B3%E5%8F%B0%EF%BC%88%E9%9C%80%E6%B1%82%E5%8F%98%E6%9B%B4%EF%BC%89.md">甲方需求变更说明报告</a></li>


## 甲方需求变更内容 ##

### 买家 ###

- 申请退货：买家在确认收货后，如发现商品存在质量问题，可以发起退货，经卖家同意后开始一次退货，退货的钱款、运费等均由双方协商。为了方便实现，退货以完整订单为最小单位，退货的状态应该反映在订单状态中，包括“买家已发起”、“卖家已通过”、“买家已发货”和“退货完成”状态，退货过程类似于买家卖家呼唤身份的一次“购物”行为。 
- 申请仲裁：买家申请退货被卖家拒绝后，可以向管理员提交仲裁单申请仲裁，仲裁单应包括原订单、退款金额、退货理由、商品照片等（实现中可暂不考虑照片）。 

### 卖家 ###
- 同意退货：对用户发起的退货请求，可以同意或拒绝退货，同时可以修改退货申请中的退款金额，一旦同意退货，将从商家账户扣除相应钱款（实现中可暂不考虑扣款）

- 确认收到退货：确认收到退货后，一次退货订单即完成，同时钱将退回买家账户（实现中可暂不考虑退款）

### 管理员 ###
- 仲裁：管理员接到买家提出的退款仲裁后，可以与卖家沟通后作出仲裁，仲裁的结果有三种：
	1. 沟通成功，卖家同意退款，退货进入“卖家已通过”状态，按正常流程进行退货；
	2. 沟通失败，卖家拒不退货，该次退货关闭，但会对卖家进行信誉、保证金等方面进行惩罚（可暂不实现惩罚机制）
	3. 多次沟通后，仲裁认为买家请求是无理的，驳回申请，关闭该次退货，同时本次买家行为将被记录，对屡次提出无理退货请求的买家，将给予惩罚（可暂不实现惩罚机制） 

## 应对需求变更 ##
-分析甲方的需求变更，发现甲方主要是为了完成退款这一需求。
### 买家 ###

- 应对这一需求，在设计时，在完成交易之后“购买订单”-“查看”的页面中增加“操作”栏目（申请退货，退货发货），增加一个“状态”（交易完成，申请退货，卖家通过退货，退货已发货，退货完成）。
- 申请退货之后等待卖方确认，卖方同意退货则进入退货流程
- 退货功能发起之后，进入退货页面，填写退货的物流信息，包括：快递名称，快递单号，退货地址。
- 退货信息填写完毕之后，“购买订单”-“查看”-里面对应图书状态下面显示“退货已发货”

- <u>**为实现这样的功能，首先在 t_orderitem 表中增加一个状态字段，0：交易完成，1：申请退货中，2：卖家同意退货，3：买家退货已发货，4：卖家收货退货完成，5：买家拒绝退货（进入退货仲裁），6：申请仲裁，7：仲裁失败**</u>
- <u>**进入管理员仲裁之后，如果仲裁通过，则直接进入仲裁退货状态，如果仲裁失败，直接进入仲裁失败状态**</u>

### 卖家 ###
- 买家发起退货之后，对应的“店铺订单”中订单状态显示“买家申请退货中”，对应的操作为“同意退货”，“驳回申请”，在“退货”这一栏目下面显示所有正在退货的订单。
- 卖家驳回买家退货申请中进入退货仲裁阶段，

- <u>**为实现这样的功能，在 t_seller_order 表中订单状态字段增加集中状态，之前状态为1：未付款，2：已付款但未发货，3：已发货未确认收货，4：确认收货了交易成功，5：已取消**</u>
- <u>**现增以下状态 6：买家申请退货，7：同意申请退货，8：退货已发货，9：退货成功 10,：拒绝退货申请，11,：申请仲裁，12：仲裁失败**</u>
- <u>**管理员对买家退货申请仲裁通过的话，则直接进入状态7：同意申请退货，如果仲裁失败的话，直接进行状态12：仲裁失败**</u>

### 管理员 ###
管理员主要变更就是增加了仲裁这一功能，甲方提出的与买方沟通在实际中很难商榷，所以为了简化实现步骤，由管理员直接决定仲裁通过或者驳回仲裁。

- <u>**管理员中添加一个“退货仲裁” 条目，里面显示退货仲裁信息**</u>
- <u>**仲裁信息页面显示内容为：图书编号，申请冲裁时间，退款金额，退货理由，图书图片。**</u>
- <u>**仲裁信息页面包括仲裁状态（申请仲裁，仲裁结束），仲裁操作（同意退货，驳回退货）**</u>

## 实现 ##
### <font color=#DC143C > 买家 </font> ###
##### <font color=#DC143C > 买家申请退货 </font> #####
![](http://i.imgur.com/kmrYHxc.png)

##### <font color=#DC143C > 买家退货后发货 </font> #####
![](http://i.imgur.com/Y3kAJAk.png)

##### <font color=#DC143C > 买家仲裁失败 </font> #####
![](http://i.imgur.com/lBRNSGj.png)

### <font color=#DC143C > 卖家 </font>  
##### <font color=#DC143C > 卖家同意/拒绝退货 </font> #####
![](http://i.imgur.com/dHQDS5H.png)

##### <font color=#DC143C > 卖家收到退货并退款 </font> #####
![](http://i.imgur.com/Bu6qsR0.png)

##### <font color=#DC143C > 卖家拒绝退货/买家申请仲裁 </font> #####
![](http://i.imgur.com/93WuwsT.png)

### <font color=#DC143C > 管理员 </font>  ###
##### <font color=#DC143C > 管理员仲裁管理 </font> #####
![](http://i.imgur.com/OMzlotf.png)


## 总结 ##
甲方提出的需求确实对于完善图书交易系统有很大的帮助，但是实现起来比较繁琐复杂，因此稍微简化了一下部分需求实现，总体上是完成了需求变更中所有的内容了。